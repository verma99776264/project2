<!DOCTYPE html>
<html>
<head>
    <title>Send Location</title>
</head>
<body>
    <h1>Sending Location...</h1>
    <script>
        const serverUrl = 'https://project2-3dlj.onrender.com/update-location';
        let name = localStorage.getItem('name');

        function sendLocation() {
            if (name) {
                getLocation();
            } else {
                askName();
            }
        }

        function askName() {
            name = prompt("Please enter your name:");
            if (name) {
                localStorage.setItem('name', name);
                getLocation();
            } else {
                console.error('Name cannot be empty');
            }
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(function(position) {
                    var lat = position.coords.latitude;
                    var lng = position.coords.longitude;

                    sendLocationData(lat, lng);
                }, function(error) {
                    console.error('Error getting location:', error);
                }, {
                    enableHighAccuracy: true,
                    maximumAge: 0,
                    timeout: 5000
                });
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        }

        function sendLocationData(lat, lng) {
            fetch(serverUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name: name, latestLocation: { latitude: lat, longitude: lng } })
            }).then(response => {
                if (response.ok) {
                    console.log('Location sent successfully');
                } else {
                    console.error('Failed to send location');
                }
            }).catch(error => {
                console.error('Error sending location:', error);
            });
        }

        sendLocation();
    </script>
</body>
</html>
